# Piper å¤¹çˆªæ§åˆ¶è¯¦ç»†è¯´æ˜ï¼ˆæ ¹æ®å®˜æ–¹æ–‡æ¡£ä¿®æ­£ï¼‰

## ğŸ”´ æ ¸å¿ƒé—®é¢˜ï¼šä¹‹å‰çš„ç†è§£å®Œå…¨é”™è¯¯ï¼

### å®˜æ–¹æ–‡æ¡£æ­£è§£ âœ…

æ ¹æ® Piper SDK å®˜æ–¹æ–‡æ¡£ï¼š

```python
def GripperCtrl(gripper_angle: int = 0,
               gripper_effort: int = 0,
               gripper_code: Literal[0x00, 0x01, 0x02, 0x03] = 0,
               set_zero: Literal[0x00, 0xAE] = 0)
```

**`gripper_angle` å‚æ•°è¯´æ˜ï¼š**
- **å•ä½ï¼š0.001mm** (ä¾‹å¦‚ï¼š50mm éœ€ä¼ å…¥ 50*1000=50000)
- **å«ä¹‰ï¼šå¤¹çˆªä¸¤æŒ‡ä¹‹é—´çš„å¼ å¼€è·ç¦»**
- **0 = å®Œå…¨é—­åˆ** (ä¸¤æŒ‡åˆæ‹¢ï¼Œ0mm å¼ å¼€)
- **70000 = å®Œå…¨æ‰“å¼€** (ä¸¤æŒ‡å¼ å¼€ 70mm)

### é”™è¯¯ç†è§£å¯¹æ¯”

| ä¹‹å‰é”™è¯¯ç†è§£ | å®˜æ–¹æ­£ç¡®è¯´æ˜ |
|-------------|-------------|
| 0 = æ‰“å¼€ âŒ | **0 = é—­åˆ** âœ… (0mm å¼ å¼€è·ç¦») |
| 100000 = é—­åˆ âŒ | **70000 = æ‰“å¼€** âœ… (70mm å¼ å¼€è·ç¦») |
| å•ä½ä¸æ˜ âŒ | **å•ä½: 0.001mm** âœ… |

## ğŸ“Š å‚æ•°è¯¦è§£

### GripperCtrl å®Œæ•´å‚æ•°

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| **gripper_angle** | int | å¤¹çˆªä½ç½®ï¼Œå•ä½ 0.001mm<br>0 = å®Œå…¨é—­åˆ<br>70000 = æ‰“å¼€ 70mm |
| **gripper_effort** | int | å¤¹çˆªæ‰­çŸ©ï¼Œå•ä½ 0.001N/m<br>èŒƒå›´ 0-5000 å¯¹åº” 0-5N/m<br>é€šå¸¸ä½¿ç”¨ 1000 (1N/m) |
| **gripper_code** | 0x00~0x03 | æ§åˆ¶ç ï¼š<br>0x00: ç¦ç”¨<br>0x01: å¯ç”¨<br>0x02: ç¦ç”¨å¹¶æ¸…é™¤é”™è¯¯<br>0x03: å¯ç”¨å¹¶æ¸…é™¤é”™è¯¯ |
| **set_zero** | 0x00/0xAE | é›¶ç‚¹è®¾ç½®ï¼š<br>0x00: æ— æ•ˆå€¼<br>0xAE: å°†å½“å‰ä½ç½®è®¾ä¸ºé›¶ç‚¹ |

### ä½ç½®å€¼ç¤ºä¾‹

```python
# å®˜æ–¹ç¤ºä¾‹ï¼šæ§åˆ¶å¤¹çˆªåˆ° 50mm ä½ç½®
range = int(0.05 * 1e6)  # 0.05m = 50mm è½¬æ¢ä¸º 0.001mm å•ä½
piper.GripperCtrl(abs(range), 1000, 0x01, 0)
```

å¯¹åº”å…³ç³»ï¼š
```
0       â†’  0mm    (å®Œå…¨é—­åˆ)
10000   â†’  10mm   (è½»å¾®å¼ å¼€)
20000   â†’  20mm   
35000   â†’  35mm   (ä¸­åº¦å¼ å¼€)
50000   â†’  50mm   
70000   â†’  70mm   (å®Œå…¨æ‰“å¼€ï¼Œæ ¹æ®é…ç½®çš„ max_range=70)
```

## ğŸ¯ åœ¨ grasp_action.py ä¸­çš„æ­£ç¡®ç”¨æ³•

```python
# åœ¨ control_arm å‡½æ•°ä¸­
if len(joints) > 6:
    joint_6 = round(position[6] * 1000 * 1000)
    piper.GripperCtrl(abs(joint_6), 1000, 0x01, 0)
```

### position[6] çš„æ­£ç¡®å«ä¹‰
```python
position[6] = 0.00   â†’ GripperCtrl(0, ...)      â†’ å®Œå…¨é—­åˆ (0mm)
position[6] = 0.05   â†’ GripperCtrl(50000, ...)  â†’ å¼ å¼€ 50mm
position[6] = 0.07   â†’ GripperCtrl(70000, ...)  â†’ å®Œå…¨æ‰“å¼€ (70mm)
```

**è®¡ç®—å…¬å¼æ­£ç¡®ç†è§£ï¼š**
```python
gripper_angle = position[6] * 1000 * 1000
# position[6] å•ä½æ˜¯ ç±³(m)
# è½¬æ¢ä¸º 0.001mm: m * 1000mm/m * 1000(å•ä½) = 0.001mm
```

## ğŸ”§ å¤¹çˆªé…ç½®å‚æ•°

```python
piper.GripperTeachingPendantParamConfig(max_load, max_range)
```

| å‚æ•° | æ¨èå€¼ | è¯´æ˜ |
|------|--------|------|
| max_load | 100 | æœ€å¤§è´Ÿè½½é…ç½® (å•ä½ä¸æ˜ï¼Œé€šå¸¸è®¾ä¸º100) |
| max_range | 70 | **æœ€å¤§è¡Œç¨‹é…ç½® (å•ä½: mm)** |

**é‡è¦è¯´æ˜ï¼š**
- `max_range=70` è¡¨ç¤ºå¤¹çˆªæœ€å¤§å¯ä»¥å¼ å¼€ 70mm
- å› æ­¤ `gripper_angle` çš„æœ€å¤§æœ‰æ•ˆå€¼åº”è¯¥æ˜¯ 70000 (70mm)
- è¶…è¿‡æ­¤å€¼å¯èƒ½æ— æ•ˆæˆ–å¯¼è‡´å¼‚å¸¸

## ğŸš¨ å¸¸è§é”™è¯¯æ€»ç»“

### 1. å‚æ•°å•ä½ç†è§£é”™è¯¯ âŒ
```python
# âŒ é”™è¯¯ï¼šä»¥ä¸ºå‚æ•°æ˜¯ç™¾åˆ†æ¯”æˆ–å…¶ä»–å•ä½
piper.GripperCtrl(100, 1000, 0x01, 0)  # åªå¼ å¼€ 0.1mmï¼Œå‡ ä¹é—­åˆ

# âœ… æ­£ç¡®ï¼šå‚æ•°å•ä½æ˜¯ 0.001mm
piper.GripperCtrl(50000, 1000, 0x01, 0)  # å¼ å¼€ 50mm
```

### 2. é—­åˆ/æ‰“å¼€æ–¹å‘ç†è§£åäº† âŒ
```python
# âŒ é”™è¯¯ï¼šä»¥ä¸ºæ•°å€¼å¤§è¡¨ç¤ºé—­åˆ
piper.GripperCtrl(100000, 1000, 0x01, 0)  # å®é™…ä¼šå¼ å¼€ 100mm

# âœ… æ­£ç¡®ï¼š0 æ‰æ˜¯å®Œå…¨é—­åˆ
piper.GripperCtrl(0, 1000, 0x01, 0)  # å®Œå…¨é—­åˆ
```

### 3. è¶…å‡ºé…ç½®çš„æœ€å¤§è¡Œç¨‹ âŒ
```python
# âŒ é”™è¯¯ï¼šè¶…å‡º max_range=70 çš„é…ç½®
piper.GripperCtrl(100000, 1000, 0x01, 0)  # è¶…è¿‡ 70mmï¼Œå¯èƒ½æ— æ•ˆ

# âœ… æ­£ç¡®ï¼šä½¿ç”¨é…ç½®èŒƒå›´å†…çš„å€¼
piper.GripperCtrl(70000, 1000, 0x01, 0)  # 70mmï¼Œæ­£å¥½æ˜¯æœ€å¤§è¡Œç¨‹
```

### 4. å¿˜è®°åˆå§‹åŒ–å¤¹çˆª âŒ
```python
# âŒ é”™è¯¯ï¼šç›´æ¥æ§åˆ¶ï¼Œå¯èƒ½æ— å“åº”
piper.GripperCtrl(0, 1000, 0x01, 0)

# âœ… æ­£ç¡®ï¼šå…ˆåˆå§‹åŒ–
piper.GripperCtrl(0, 1000, 0x02, 0)  # ç¦ç”¨å¹¶æ¸…é™¤é”™è¯¯
time.sleep(0.1)
piper.GripperCtrl(0, 1000, 0x01, 0)  # å¯ç”¨å¹¶é—­åˆ
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. åˆå§‹åŒ–æµç¨‹ï¼ˆå®˜æ–¹æ¨èï¼‰
```python
from piper_sdk import *
import time

piper = C_PiperInterface_V2("can0")
piper.ConnectPort()

# ç­‰å¾…æœºæ¢°è‡‚å¯ç”¨
while not piper.EnablePiper():
    time.sleep(0.01)

# åˆå§‹åŒ–å¤¹çˆªï¼ˆç¦ç”¨å¹¶æ¸…é™¤é”™è¯¯ï¼‰
piper.GripperCtrl(0, 1000, 0x02, 0)
time.sleep(0.1)

# å¯ç”¨å¤¹çˆªå¹¶é—­åˆ
piper.GripperCtrl(0, 1000, 0x01, 0)
time.sleep(0.1)
```

### 2. æŠ“å–ç‰©ä½“çš„æ ‡å‡†æµç¨‹ï¼ˆä¿®æ­£ç‰ˆï¼‰
```python
# 1. ç§»åŠ¨åˆ°ç›®æ ‡ä¸Šæ–¹ï¼Œå¤¹çˆªå®Œå…¨æ‰“å¼€
joints = [..., 0.07]  # position[6] = 0.07m = 70mm æ‰“å¼€
control_arm(joints, 20)
time.sleep(2)

# 2. ä¸‹é™åˆ°ç›®æ ‡ä½ç½®
# ...

# 3. é€‚åº¦é—­åˆå¤¹çˆªï¼ˆæ ¹æ®ç‰©ä½“å¤§å°è°ƒæ•´ï¼‰
joints[6] = 0.02  # position[6] = 0.02m = 20mm å¼ å¼€ï¼Œé€‚åˆæŠ“å°ç‰©ä½“
control_arm(joints, 20)
time.sleep(2)

# 4. æå‡å¹¶è¿”å›
# ...
```

### 3. æ¸è¿›å¼é—­åˆï¼ˆæŸ”æ€§æŠ“å–ï¼‰
```python
# ä»æ‰“å¼€åˆ°é—­åˆï¼Œé€æ­¥å‡å°å¼ å¼€è·ç¦»
for angle in [70000, 50000, 30000, 10000, 0]:
    mm = angle / 1000
    print(f"å¼ å¼€è·ç¦»: {mm}mm")
    piper.GripperCtrl(angle, 1000, 0x01, 0)
    time.sleep(0.5)
```

## ğŸ” è°ƒè¯•æ–¹æ³•

### 1. æ£€æŸ¥å¤¹çˆªå‚æ•°é…ç½®
```python
# é…ç½®å¤¹çˆªå‚æ•°
piper.GripperTeachingPendantParamConfig(100, 70)
piper.ArmParamEnquiryAndConfig(4)
time.sleep(1)

# è¯»å–é…ç½®åé¦ˆ
feedback = piper.GetGripperTeachingPendantParamFeedback()
print("å¤¹çˆªé…ç½®:", feedback)
```

### 2. æ£€æŸ¥ä½¿èƒ½çŠ¶æ€
```python
low_spd_info = piper.GetArmLowSpdInfoMsgs()
enable_status = low_spd_info.motor_1.foc_status.driver_enable_status
print("ä½¿èƒ½çŠ¶æ€:", enable_status)
```

### 3. æµ‹è¯•ä¸åŒå¼ å¼€è·ç¦»
```python
test_angles = [0, 10000, 20000, 35000, 50000, 70000]
for angle in test_angles:
    mm = angle / 1000
    print(f"æµ‹è¯•: {mm}mm å¼ å¼€")
    piper.GripperCtrl(angle, 1000, 0x01, 0)
    time.sleep(2)
    input("æŒ‰å›è½¦ç»§ç»­...")
```

## ğŸ“ æ€»ç»“

**å…³é”®è®°å¿†ç‚¹ï¼ˆå®˜æ–¹æ–‡æ¡£ç‰ˆï¼‰ï¼š**
1. âœ… å‚æ•°å•ä½æ˜¯ **0.001mm**
2. âœ… `0` = å®Œå…¨**é—­åˆ** (0mm å¼ å¼€)
3. âœ… `70000` = å®Œå…¨**æ‰“å¼€** (70mm å¼ å¼€ï¼Œæ ¹æ®é…ç½®)
4. âœ… æ•°å€¼è¡¨ç¤º**ä¸¤æŒ‡ä¹‹é—´çš„å¼ å¼€è·ç¦»**
5. âœ… åœ¨ä»£ç ä¸­ä½¿ç”¨ `position[6](ç±³) * 1000000` è½¬æ¢
6. âœ… åˆå§‹åŒ–æ—¶å…ˆæ¸…é™¤é”™è¯¯ (code=0x02)ï¼Œå†å¯ç”¨ (code=0x01)
7. âœ… æ‰­çŸ©é€šå¸¸ä½¿ç”¨ 1000 (å¯¹åº” 1N/m)

**é—­åˆä¸å®Œå…¨çš„å¯èƒ½åŸå› ï¼š**
1. å‘é€äº†é”™è¯¯çš„æ•°å€¼ï¼ˆå¦‚ 100000 è€Œä¸æ˜¯ 0ï¼‰
2. å¤¹çˆªå‚æ•°æœªæ­£ç¡®é…ç½®
3. å¤¹çˆªæœªæ­£ç¡®ä½¿èƒ½æˆ–åˆå§‹åŒ–
4. ç‰©ç†éšœç¢ç‰©é˜»æ­¢å¤¹çˆªé—­åˆ
5. å¤¹çˆªéœ€è¦é‡æ–°è®¾ç½®é›¶ç‚¹
